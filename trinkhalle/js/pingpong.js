playing = true; yPosLeftBat = yPosRightBat = 40; batDistanceToBorder = 40; batWidth = 10; batHeight = 100; xPosBall = yPosBall = 50; ballWidth = 10; xSpeed = ySpeed = 10; score1 = score2 = 0; aiSpeed = 6; goal = 10; gametimeS = gametimeM = 0; lastPoint = 0; pausethick = 20; pauseheight = 100; const fillStyleDefault = 'RGB(204,204,204)'; fillStyleLeft = fillStyleDefault; fillStyleRight = fillStyleDefault; streak = 0; streakGoal = 3; streakRed = 255; streakGreen = 0; streakBlue = 0; window.onload = ()=> { var iframe = document.getElementById('iframe_pingpong_game'); var iframeDocument = iframe.contentDocument; if(!iframeDocument){throw "iframe couldn't be found in DOM.";} c = iframeDocument.getElementById('gameCanvas'); /*******************************/ cc = c.getContext('2d'); cc.font = '20px Arial'; c.addEventListener("click",pause); setInterval(update, 1000/30); setInterval(()=>{ if(playing){ gametimeS++; lastPoint++; if(gametimeS == 60){ gametimeM++; gametimeS = 0; } if(gametimeM==0){ document.getElementById("gametime").innerHTML="Spielzeit: "+gametimeS+"s"; }else{ document.getElementById("gametime").innerHTML="Spielzeit: "+gametimeM+"m "+gametimeS+"s"; } } },1000); c.addEventListener('mousemove', (e)=> { yPosLeftBat = e.clientY-batHeight/2; }); }; function pause(){ if(playing){ playing = false; document.getElementById("pause").textContent="Weiter"; cc.fillStyle='white'; cc.fillRect(c.width/2-pausethick, c.height/2-pauseheight/2, pausethick, pauseheight); cc.fillRect(c.width/2+pausethick, c.height/2-pauseheight/2, pausethick, pauseheight); }else{ playing = true; document.getElementById("pause").textContent="Pause"; } } function winner(i){ pause(); if(i==1){ alert("You won! "+score1+":"+score2); }else{ alert("You lost! "+score1+":"+score2); } score1 = score2 = 0; pause(); newGame(); } function reset() { xPosBall = c.width/2; yPosBallx = c.height/2; xSpeed = -xSpeed; ySpeed = 3; lastPoint = 0; } function newGame(){ reset(); playing = true; gametimeM = gametimeS = 0; score1 = score2 = 0; streak = 0; fillStyleLeft = fillStyleDefault; fillStyleRight = fillStyleDefault; document.getElementById("gametime").innerHTML="Spielzeit: 0s"; } function getFillStyle(){ var s=20; if (streakRed==255&&streakBlue==0&&streakGreen<255){ streakGreen+=s; }else if(streakGreen==255&&streakBlue==0&&streakRed>0){ streakRed-=s; }else if(streakRed==0&&streakGreen==255&&streakBlue<255){ streakBlue+=s; }else if(streakRed==0&&streakBlue==255&&streakGreen>0){ streakGreen-=s; }else if(streakGreen==0&&streakBlue==255&&streakRed<255){ streakRed+=s; }else if(streakRed==255&&streakGreen==0&&streakBlue>0){ streakBlue-=s; } if(streakRed>255){ streakRed=255; }else if(streakRed<0){ streakRed=0; } if(streakGreen>255){ streakGreen=255; }else if(streakGreen<0){ streakGreen=0; } if(streakBlue>255){ streakBlue=255; }else if(streakBlue<0){ streakBlue=0; } var rgb = 'RGB('+streakRed+','+streakGreen+','+streakBlue+')'; return rgb; } function update() { if(playing){ xPosBall += xSpeed; yPosBall += ySpeed; if (yPosBall < 0 && ySpeed < 0) { ySpeed = -ySpeed; } if (yPosBall > c.height && ySpeed > 0) { ySpeed = -ySpeed; } ballHitsBat=batDistanceToBorder+batWidth; if (xPosBall < 0) { score2++; reset(); if(streak>0){ streak = -1; fillStyleLeft = fillStyleDefault; }else{ streak--; } } if (xPosBall==ballHitsBat){ if(yPosBall > yPosLeftBat && yPosBall < yPosLeftBat + batHeight){ xSpeed = -xSpeed; deltaY = yPosBall - (yPosLeftBat + batHeight/2); ySpeed = deltaY*0.3; } } if (xPosBall > c.width) { score1++; reset(); if(streak<0){ streak = 1; fillStyleRight = fillStyleDefault; }else{ streak++; } } if(xPosBall==c.width-ballHitsBat){ if (yPosBall > yPosRightBat && yPosBall < yPosRightBat + batHeight) { xSpeed = -xSpeed; deltaY = yPosBall - (yPosRightBat + batHeight/2); ySpeed = deltaY*0.3; } } if (yPosRightBat+batHeight/2 < yPosBall || yPosRightBat+batHeight/2 < yPosBall+10) { yPosRightBat += aiSpeed; } if (yPosRightBat+batHeight/2 > yPosBall || yPosRightBat+batHeight/2 > yPosBall-10) { yPosRightBat -= aiSpeed; } /*********    STREAK    *********/ if(streak>=streakGoal){ fillStyleLeft = getFillStyle(); }else if(Math.abs(streak)>=streakGoal){ fillStyleRight = getFillStyle(); } /********** DISPLAY GAME *********/ cc.font = "40px Arial"; cc.fillStyle = 'black'; cc.fillRect(0, 0, c.width, c.height); cc.fillStyle = fillStyleDefault; cc.fillRect(xPosBall-ballWidth/2, yPosBall-ballWidth/2, ballWidth, ballWidth); cc.fillStyle = fillStyleLeft; if(yPosLeftBat+batHeight>c.height){ cc.fillRect(batDistanceToBorder, c.height-batHeight, batWidth, batHeight); }else if(yPosLeftBat<0){ cc.fillRect(batDistanceToBorder, 0, batWidth, batHeight); }else{ cc.fillRect(batDistanceToBorder, yPosLeftBat, batWidth, batHeight); } cc.fillText(score1, 100, 50); cc.fillStyle = fillStyleRight; if(yPosRightBat+batHeight>c.height){ cc.fillRect(c.width-batWidth-batDistanceToBorder, c.height-batHeight, batWidth, batHeight); }else if(yPosRightBat<0){ cc.fillRect(c.width-batWidth-batDistanceToBorder, 0, batWidth, batHeight); }else{ cc.fillRect(c.width-batWidth-batDistanceToBorder, yPosRightBat, batWidth, batHeight); } cc.fillText(score2, c.width-100, 50); if(score1==goal){ winner(1); }else if(score2==goal){ winner(2); } /********* ************ *********/ } }